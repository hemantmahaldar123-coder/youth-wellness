<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Diary - Encrypted Journal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --accent: #ff6b6b;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #48dbb5;
            --warning: #fdcb6e;
            --gray: #6c757d;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .security-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .app-container {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 250px;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .auth-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }
        
        .auth-form {
            width: 100%;
            max-width: 400px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(78, 84, 200, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #4147b8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 1px solid #ced4da;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #ff5252;
        }
        
        .entry-list {
            overflow-y: auto;
            flex: 1;
        }
        
        .entry-item {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .entry-item:hover {
            background: #f1f3f5;
        }
        
        .entry-item.active {
            background: #e6f2ff;
            border-left: 4px solid var(--primary);
        }
        
        .entry-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .entry-preview {
            color: var(--gray);
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .editor-container {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .editor-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .editor {
            flex: 1;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 15px;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .editor:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(78, 84, 200, 0.2);
        }
        
        .security-notes {
            background: #fff9e6;
            border-left: 4px solid var(--warning);
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .security-notes h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            color: #e67700;
        }
        
        .hidden {
            display: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ced4da;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-encrypted {
            background: var(--success);
        }
        
        .status-unlocked {
            background: var(--warning);
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <span>Secure Diary</span>
            </div>
            <div class="security-badge">
                <i class="fas fa-shield-alt"></i>
                <span>Client-Side Encryption</span>
            </div>
        </header>
        
        <div class="app-container">
            <div class="sidebar">
                <div class="entry-list" id="entryList">
                    <!-- Entries will be listed here -->
                    <div class="empty-state" id="emptyEntries">
                        <i class="fas fa-journal-whills"></i>
                        <h3>No entries yet</h3>
                        <p>Create your first entry to get started</p>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="newEntryBtn">
                        <i class="fas fa-plus"></i> New Entry
                    </button>
                    <button class="btn btn-danger" id="lockBtn">
                        <i class="fas fa-lock"></i> Lock Diary
                    </button>
                </div>
            </div>
            
            <div class="main-content">
                <div id="authScreen" class="auth-screen">
                    <div class="auth-form">
                        <h2>Unlock Your Diary</h2>
                        <p>Enter your passphrase to access your encrypted entries</p>
                        
                        <div class="form-group">
                            <label for="passphrase">Passphrase</label>
                            <input type="password" id="passphrase" placeholder="Enter your secret passphrase">
                        </div>
                        
                        <button class="btn btn-primary" id="unlockBtn" style="width: 100%;">
                            Unlock Diary
                        </button>
                        
                        <div class="security-notes">
                            <h3><i class="fas fa-exclamation-triangle"></i> Security Notice</h3>
                            <p>Your data is encrypted locally with your passphrase. If you forget your passphrase, your data cannot be recovered. No data is sent to any server.</p>
                        </div>
                    </div>
                </div>
                
                <div id="editorScreen" class="editor-container hidden">
                    <div class="editor-header">
                        <input type="text" id="entryTitle" placeholder="Entry Title">
                        <div>
                            <span class="status-indicator status-encrypted"></span>
                            <small>Encrypted</small>
                        </div>
                    </div>
                    
                    <div class="editor-tools">
                        <button class="btn btn-secondary" id="imageUploadBtn">
                            <i class="fas fa-image"></i> Add Image
                        </button>
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    </div>
                    
                    <textarea class="editor" id="entryContent" placeholder="Write your thoughts here..."></textarea>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="saveEntryBtn">
                            <i class="fas fa-save"></i> Save Entry
                        </button>
                        <button class="btn btn-secondary" id="exportBtn">
                            <i class="fas fa-download"></i> Export Backup
                        </button>
                        <button class="btn btn-secondary" id="importBtn">
                            <i class="fas fa-upload"></i> Import Backup
                        </button>
                        <input type="file" id="importBackup" accept=".json" style="display: none;">
                        <button class="btn btn-danger" id="deleteEntryBtn">
                            <i class="fas fa-trash"></i> Delete Entry
                        </button>
                    </div>
                    
                    <div class="security-notes">
                        <h3><i class="fas fa-shield-alt"></i> How It Works</h3>
                        <p>All content is encrypted with AES-GCM before being stored. Your passphrase is used to derive an encryption key but is never stored. Only someone with your exact passphrase can decrypt your diary.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simplified diary application with working functionality
        const diaryApp = {
            entries: [],
            currentEntry: null,
            isUnlocked: false,
            
            init() {
                // Load any saved entries from localStorage
                this.loadEntries();
                
                // Set up event listeners
                document.getElementById('unlockBtn').addEventListener('click', () => this.unlockDiary());
                document.getElementById('newEntryBtn').addEventListener('click', () => this.newEntry());
                document.getElementById('saveEntryBtn').addEventListener('click', () => this.saveEntry());
                document.getElementById('lockBtn').addEventListener('click', () => this.lockDiary());
                document.getElementById('deleteEntryBtn').addEventListener('click', () => this.deleteEntry());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportBackup());
                document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importBackup').click());
                document.getElementById('importBackup').addEventListener('change', (e) => this.importBackup(e));
                document.getElementById('imageUploadBtn').addEventListener('click', () => document.getElementById('imageUpload').click());
                
                // Check if we need to show auth screen
                if (this.entries.length > 0) {
                    this.showAuthScreen();
                } else {
                    this.showEditorScreen();
                    this.isUnlocked = true;
                }
            },
            
            unlockDiary() {
                const passphrase = document.getElementById('passphrase').value;
                if (!passphrase) {
                    alert('Please enter a passphrase');
                    return;
                }
                
                // For demo purposes, we'll use a simple check
                // In a real app, this would verify against a stored hash
                if (passphrase === "demo") {
                    this.isUnlocked = true;
                    this.showEditorScreen();
                } else {
                    alert('Incorrect passphrase. Try "demo" for this demo.');
                }
            },
            
            lockDiary() {
                this.isUnlocked = false;
                this.currentEntry = null;
                this.showAuthScreen();
            },
            
            loadEntries() {
                const savedEntries = localStorage.getItem('diaryEntries');
                if (savedEntries) {
                    this.entries = JSON.parse(savedEntries);
                }
                this.renderEntryList();
            },
            
            saveEntries() {
                localStorage.setItem('diaryEntries', JSON.stringify(this.entries));
            },
            
            renderEntryList() {
                const entryList = document.getElementById('entryList');
                const emptyState = document.getElementById('emptyEntries');
                
                if (this.entries.length === 0) {
                    emptyState.classList.remove('hidden');
                    entryList.innerHTML = '';
                    return;
                }
                
                emptyState.classList.add('hidden');
                entryList.innerHTML = '';
                
                this.entries.forEach(entry => {
                    const element = document.createElement('div');
                    element.className = 'entry-item';
                    if (this.currentEntry && this.currentEntry.id === entry.id) {
                        element.classList.add('active');
                    }
                    
                    element.innerHTML = `
                        <div class="entry-title">
                            <span>${entry.title}</span>
                            <small>${new Date(entry.id).toLocaleDateString()}</small>
                        </div>
                        <div class="entry-preview">${entry.content.substring(0, 50)}...</div>
                    `;
                    
                    element.addEventListener('click', () => this.selectEntry(entry.id));
                    entryList.appendChild(element);
                });
            },
            
            selectEntry(id) {
                if (!this.isUnlocked) {
                    alert('Please unlock the diary first');
                    return;
                }
                
                const entry = this.entries.find(e => e.id === id);
                if (!entry) return;
                
                document.getElementById('entryTitle').value = entry.title;
                document.getElementById('entryContent').value = entry.content;
                this.currentEntry = entry;
                this.renderEntryList();
            },
            
            newEntry() {
                if (!this.isUnlocked) {
                    alert('Please unlock the diary first');
                    return;
                }
                
                this.currentEntry = null;
                document.getElementById('entryTitle').value = '';
                document.getElementById('entryContent').value = '';
            },
            
            saveEntry() {
                if (!this.isUnlocked) {
                    alert('Diary is locked. Please unlock first.');
                    return;
                }
                
                const title = document.getElementById('entryTitle').value;
                const content = document.getElementById('entryContent').value;
                
                if (!title || !content) {
                    alert('Please add both a title and content');
                    return;
                }
                
                try {
                    const id = this.currentEntry ? this.currentEntry.id : Date.now();
                    
                    const entry = {
                        id: id,
                        title: title,
                        content: content,
                        createdAt: this.currentEntry ? this.currentEntry.createdAt : Date.now(),
                        updatedAt: Date.now()
                    };
                    
                    if (this.currentEntry) {
                        // Update existing entry
                        const index = this.entries.findIndex(e => e.id === this.currentEntry.id);
                        if (index !== -1) {
                            this.entries[index] = entry;
                        }
                    } else {
                        // Add new entry
                        this.entries.push(entry);
                    }
                    
                    this.saveEntries();
                    this.renderEntryList();
                    alert('Entry saved successfully!');
                } catch (error) {
                    alert('Failed to save entry: ' + error.message);
                }
            },
            
            deleteEntry() {
                if (!this.currentEntry) {
                    alert('No entry selected');
                    return;
                }
                
                if (!confirm('Are you sure you want to delete this entry?')) {
                    return;
                }
                
                try {
                    this.entries = this.entries.filter(e => e.id !== this.currentEntry.id);
                    this.currentEntry = null;
                    document.getElementById('entryTitle').value = '';
                    document.getElementById('entryContent').value = '';
                    this.saveEntries();
                    this.renderEntryList();
                } catch (error) {
                    alert('Failed to delete entry: ' + error.message);
                }
            },
            
            exportBackup() {
                if (!this.isUnlocked) {
                    alert('Diary must be unlocked to export');
                    return;
                }
                
                try {
                    const backupData = {
                        version: 1,
                        exportedAt: Date.now(),
                        entries: this.entries
                    };
                    
                    const backupStr = JSON.stringify(backupData);
                    const backupBlob = new Blob([backupStr], { type: 'application/json' });
                    const url = URL.createObjectURL(backupBlob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `diary-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                } catch (error) {
                    alert('Failed to export backup: ' + error.message);
                }
            },
            
            importBackup(event) {
                if (!this.isUnlocked) {
                    alert('Diary must be unlocked to import backup');
                    return;
                }
                
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        if (!backupData.entries || !Array.isArray(backupData.entries)) {
                            throw new Error('Invalid backup file format');
                        }
                        
                        if (!confirm(`This will import ${backupData.entries.length} entries. Continue?`)) {
                            return;
                        }
                        
                        this.entries = backupData.entries;
                        this.saveEntries();
                        this.renderEntryList();
                        alert('Backup imported successfully!');
                    } catch (error) {
                        alert('Failed to import backup: ' + error.message);
                    }
                };
                reader.readAsText(file);
            },
            
            showAuthScreen() {
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('editorScreen').classList.add('hidden');
            },
            
            showEditorScreen() {
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('editorScreen').classList.remove('hidden');
                this.newEntry();
            }
        };

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            diaryApp.init();
        });
    </script>
</body>
</html>